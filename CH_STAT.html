<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì±„ë„ í†µê³„ ê´€ë¦¬ì ì‹œìŠ¤í…œ</title>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore, collection, addDoc, updateDoc,
  deleteDoc, doc, onSnapshot, query, orderBy
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* ğŸ”¥ Firebase */
const firebaseConfig = {
  apiKey: "AIzaSyBpfdrOZh7Jo1nFABHqOhkhl_Id_DYNueU",
  authDomain: "channel-statistics-275ba.firebaseapp.com",
  projectId: "channel-statistics-275ba",
  storageBucket: "channel-statistics-275ba.firebasestorage.app",
  messagingSenderId: "85099988183",
  appId: "1:85099988183:web:fae23a9b13c6fa4de25c92"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let currentTab = "tigerTheater";
let allData = [];
let unsubscribe = null;

/* =========================
   íƒ­ ì „í™˜
========================= */

window.switchTab = function(tab){
  currentTab = tab;

  document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
  document.getElementById(tab+"Tab").classList.add("active");

  loadData();
  renderHeader();
};

function loadData(){
  if(unsubscribe) unsubscribe();

  const q = query(collection(db,currentTab), orderBy("no"));
  unsubscribe = onSnapshot(q, snap=>{
    allData = snap.docs.map(d=>({id:d.id,...d.data()}));
    renderTable();
  });
}

/* =========================
   ì¼ê´„ ì…ë ¥
========================= */

window.bulkInsert = async function(){
  const text = document.getElementById("bulk").value.trim();
  if(!text) return;

  const lines = text.split("\n");

  let startNo = allData.length + 1;

  for(let line of lines){
    const cols = line.split("\t");

    if(currentTab==="tigerTheater"){
      await addDoc(collection(db,currentTab),{
        no: startNo++,
        channel: cols[1],
        date: cols[2],
        time: cols[3],
        phone: cols[4],
        memo: cols[5],
        manager: cols[6]
      });
    }

    if(currentTab==="holeInOne"){
      await addDoc(collection(db,currentTab),{
        no: startNo++,
        channel: cols[1],
        date: cols[2],
        time: cols[3],
        applicant: cols[4],
        phone: cols[5],
        memo: cols[6],
        manager: cols[7]
      });
    }
  }

  document.getElementById("bulk").value="";
};

/* =========================
   ë Œë”ë§
========================= */

function renderHeader(){
  const thead = document.getElementById("thead");

  if(currentTab==="tigerTheater"){
    thead.innerHTML=`
      <tr>
      <th>ë²ˆí˜¸</th><th>ì±„ë„ëª…</th><th>ë‚ ì§œ</th><th>ì‹œê°„</th>
      <th>íœ´ëŒ€ì „í™”</th><th>ë©”ëª¨</th><th>ë‹´ë‹¹ì</th>
      </tr>`;
  }

  if(currentTab==="holeInOne"){
    thead.innerHTML=`
      <tr>
      <th>ë²ˆí˜¸</th><th>ì±„ë„ëª…</th><th>ë‚ ì§œ</th><th>ì‹œê°„</th>
      <th>ì‹ ì²­ì</th><th>íœ´ëŒ€ì „í™”</th><th>ë©”ëª¨</th><th>ë‹´ë‹¹ì</th>
      </tr>`;
  }

  if(currentTab==="dbStats"){
    thead.innerHTML=`<tr><th>DBí†µê³„ ì˜ì—­</th></tr>`;
  }
}

function renderTable(){
  const tbody = document.getElementById("tbody");
  tbody.innerHTML="";

  allData.forEach(d=>{
    if(currentTab==="tigerTheater"){
      tbody.innerHTML+=`
      <tr>
      <td>${d.no}</td>
      <td>${d.channel}</td>
      <td>${d.date}</td>
      <td>${d.time}</td>
      <td>${d.phone}</td>
      <td>${d.memo}</td>
      <td>${d.manager}</td>
      </tr>`;
    }

    if(currentTab==="holeInOne"){
      tbody.innerHTML+=`
      <tr>
      <td>${d.no}</td>
      <td>${d.channel}</td>
      <td>${d.date}</td>
      <td>${d.time}</td>
      <td>${d.applicant}</td>
      <td>${d.phone}</td>
      <td>${d.memo}</td>
      <td>${d.manager}</td>
      </tr>`;
    }
  });
}

/* ì´ˆê¸° ë¡œë“œ */
window.onload=()=>{
  switchTab("tigerTheater");
};

</script>

<style>
body{font-family:sans-serif;padding:30px;background:#f4f6f9;}
.tabs{margin-bottom:20px;}
.tab{
  display:inline-block;
  padding:10px 20px;
  background:#ddd;
  cursor:pointer;
  border-radius:8px 8px 0 0;
}
.tab.active{background:#ffffff;font-weight:bold;}
.card{background:white;padding:20px;margin-bottom:20px;border-radius:10px;}
table{width:100%;border-collapse:collapse;background:white;}
th,td{border:1px solid #ddd;padding:8px;text-align:center;}
textarea{width:100%;height:120px;}
</style>
</head>

<body>

<h1>ì±„ë„ í†µê³„ ê´€ë¦¬ì</h1>

<div class="tabs">
  <div class="tab active" id="tigerTheaterTab" onclick="switchTab('tigerTheater')">í˜¸ë‘ì´ê·¹ì¥</div>
  <div class="tab" id="holeInOneTab" onclick="switchTab('holeInOne')">ì£¼ì‹í™€ì¸ì›</div>
  <div class="tab" id="dbStatsTab" onclick="switchTab('dbStats')">DBí†µê³„</div>
</div>

<div class="card">
  <h3>ì¼ê´„ ë¶™ì—¬ë„£ê¸° (ì—‘ì…€ ê·¸ëŒ€ë¡œ ë³µë¶™)</h3>
  <textarea id="bulk"></textarea>
  <button onclick="bulkInsert()">ì¼ê´„ ì…ë ¥</button>
</div>

<table>
<thead id="thead"></thead>
<tbody id="tbody"></tbody>
</table>

</body>
</html>